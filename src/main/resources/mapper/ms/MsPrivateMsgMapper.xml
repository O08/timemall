<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.norm.timemall.app.ms.mapper.MsPrivateMsgMapper">
    <sql id="tableName">
        private_msg
    </sql>

    <resultMap id="defaultEventRecordResultMap" type="com.norm.timemall.app.ms.domain.pojo.MsDefaultEventRecord">
        <result property="stampDate" column="stampDate"/>
        <collection property="cards" ofType="com.norm.timemall.app.ms.domain.pojo.MsDefaultEventCard" javaType="ArrayList">
            <result property="author" column="author"/>
            <result property="authorIcon" column="authorIcon"/>
            <result property="authorId" column="author_id"/>
            <result property="createAt" column="create_at"/>
            <result property="msg" column="msg"/>
            <result property="msgType" column="msg_type"/>
            <result property="id" column="msg_id"/>
        </collection>
    </resultMap>

    <resultMap id="defaultEventResultMap" type="com.norm.timemall.app.ms.domain.pojo.MsDefaultEvent">
        <result property="room" column="room"/>
        <collection property="records" ofType="com.norm.timemall.app.ms.domain.pojo.MsDefaultEventRecord" javaType="ArrayList" resultMap="defaultEventRecordResultMap"/>
    </resultMap>

    <select id="selectEventByFromIdAndToId" resultMap="defaultEventResultMap">
        select m.msg_id,#{friend} room,DATE_FORMAT(m.create_at,"%Y-%m-%d") stampDate,b.brand_name author,b.avator authorIcon,m.from_id author_id,m.create_at,m.msg_type,m.msg
        from private_msg m
        left join brand b
        on b.customer_id = m.from_id
        where
          m.owner_user_id=#{current_user_id}
          and ((m.from_id = #{friend}
                 and m.to_id= #{current_user_id})
             or (m.from_id = #{current_user_id}
                 and m.to_id= #{friend}))
        order by m.create_at
    </select>

</mapper>